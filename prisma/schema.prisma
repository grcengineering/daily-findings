generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model DailySession {
  id              String    @id @default(cuid())
  date            String    @unique
  domain          String
  topic           String
  topicId         String
  level           String
  lessonContent   String
  scenarioContent String
  quizContent     String
  newsContent     String
  completed       Boolean   @default(false)
  quizScore       Int?
  quizTotal       Int?
  startedAt       DateTime?
  completedAt     DateTime?
  createdAt       DateTime  @default(now())
}

model TopicProgress {
  id           String    @id @default(cuid())
  domain       String
  topicId      String    @unique
  topic        String
  level        String
  timesStudied Int       @default(0)
  lastStudied  DateTime?
  quizScores   String    @default("[]")
  nextReviewAt DateTime?
}

model UserStats {
  id              String  @id @default("user")
  currentStreak   Int     @default(0)
  longestStreak   Int     @default(0)
  totalSessions   Int     @default(0)
  totalXp         Int     @default(0)
  currentLevel    Int     @default(1)
  lastSessionDate String?
  selectedPathId  String?
  ttsVoiceUri     String?
  ttsRate         Float   @default(1.0)
}

model SessionContent {
  id              String   @id @default(cuid())
  topicId         String   @unique
  domain          String
  topic           String
  level           String
  moduleType      String   @default("core")
  competencyIds   String   @default("[]")
  prerequisites   String   @default("[]")
  lessonContent   String
  scenarioContent String
  quizContent     String
  capstoneContent String?
  generatedAt     DateTime @default(now())
}

model SessionCompletion {
  id                  String   @id @default(cuid())
  topicId             String
  date                String
  quizScore           Int?
  quizTotal           Int?
  capstoneRubricScores String?
  recommendationReason String?
  completedAt         DateTime @default(now())

  @@unique([topicId, date])
  @@index([topicId])
  @@index([date])
}

model ReadingPosition {
  id        String   @id @default(cuid())
  topicId   String
  section   String
  scrollY   Int      @default(0)
  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())

  @@unique([topicId, section])
  @@index([topicId])
}

model CapstoneRubricState {
  id           String   @id @default(cuid())
  topicId      String
  date         String
  rubricScores String   @default("{}")
  updatedAt    DateTime @updatedAt
  createdAt    DateTime @default(now())

  @@unique([topicId, date])
  @@index([topicId])
}

model QuestionAnalytics {
  id             String   @id @default(cuid())
  topicId        String
  questionId     String
  questionIndex  Int
  format         String
  correctRate    Float?
  attemptCount   Int      @default(0)
  discrimination Float?
  firstTryCorrect Int     @default(0)
  retryCount     Int      @default(0)
  optionStats    String   @default("{}")
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@unique([topicId, questionId])
  @@index([topicId])
  @@index([questionId])
}
